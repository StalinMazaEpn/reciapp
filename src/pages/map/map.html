<ion-content>
    

    <ion-card no-margin>
        <agm-map [latitude]="latView" [longitude]="lngView" [zoom]="zoom" [fullscreenControlOptions]="false" [zoomControl]="false" [streetViewControl]="false" [usePanning]="true" (centerChange)="centerChange($event)" (zoomChange)="zoomChange($event)">
            <agm-marker [latitude]="lat" [longitude]="lng"></agm-marker>
            <agm-marker [iconUrl]="'assets/imgs/recyclers1.png'" *ngFor="let recycler of recyclers" (markerClick)="goToRecycler(recycler)" [latitude]="recycler.latitude" [longitude]="recycler.longitude"></agm-marker>
          </agm-map>
          <ion-fab left middle>
            <button ion-fab mini (tap)="getViewLocation()" >
              <ion-icon ios="ios-locate" md="md-locate"></ion-icon>
            </button>
          </ion-fab>
          <ion-fab right middle>
            <button ion-fab mini (click)="addRecycler()">
              <ion-icon ios="ios-person-add" md="md-person-add"></ion-icon>
            </button>
          </ion-fab>
          
      </ion-card>

      <ion-row *ngIf="!isAuthenticated" text-center style="margin-top: 15%;">
        <ion-card text-center class="segmentText">
          <ion-card-content>
            <ion-item text-center>Debes iniciar sesión</ion-item>
            <div >Para registrar tus recicladores favoritos</div>
            <ion-row text-center>
              <ion-col col-12>
                <button ion-button round (click)="login()" >Iniciar Sesión</button>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>
      </ion-row>
      
      

      <!-- -->
      <ion-item *ngIf="isAuthenticated" class="segmentText">
          <ion-toolbar >
              <ion-segment style="background: #2C3E50" [(ngModel)]="recyclerm" >
                <ion-segment-button  value="favorite"  style="color: white" > <!--*ngIf="isAuthenticated"-->
                  Favoritos
                </ion-segment-button>
                <!--ion-segment-button value="near" style="color:white" >
                  Negocios Asociados
                </ion-segment-button-->
              </ion-segment>
          </ion-toolbar>
          <div [ngSwitch]="recyclerm">         
            <ion-list *ngSwitchCase="'favorite'">
              <ion-row *ngIf="(recyclersFavorites | async)?.length==0" text-center>
                <ion-card text-center>
                  <ion-card-content>
                    <ion-item text-wrap text-center>No tienes recicladores favoritos</ion-item>
                    <div text-wrap text-center>Encuentra tu reciclador más cercano en el mapa</div>
                    <!--div text-center>
                        <button ion-button outline item-end icon-left (click)="openMap()">
                          <ion-icon name="add-circle"></ion-icon>
                            Agregar Favorito
                        </button>
                    </div-->
                  </ion-card-content>
                </ion-card>
              </ion-row>

              <ion-row *ngFor='let recycler$ of recyclersFavorites | async'>            
                <ion-col *ngIf="recycler$ | async as recycler;  else loading" >
                    <ion-grid>
                        <ion-row >
                          <ion-col col-2 style="margin-top: 2%">
                              <!--ion-item (tap)="goToRecycler(recycler)">
                                  <ion-avatar item-start>
                                    <img src="{{recycler.image}}">
                                  </ion-avatar>
                                  <h2>{{recycler.name}}</h2>
                                </ion-item-->
                                <span  (tap)="goToRecycler(recycler)" >
                                    <ion-row *ngIf="recycler.image!=undefined; else firstLetter">
                                            <ion-col col-4>
                                              <ion-avatar>
                                                <img class="recyclers" src="{{recycler.image}}" id="{{recycler.id}}">
                                              </ion-avatar>	
                                            </ion-col>
                                    </ion-row>
                                    
                                      <ng-template #firstLetter item-center>
                                        <ion-avatar>
                                          <span text-center>
                                            <p class="firstLetter" >{{recycler.name.charAt(0).toUpperCase()}}</p>
                                            <img class="recyclers" style="background-color: #32db64" id="{{recycler.id}}">
                                          </span>
                                        </ion-avatar>	
                                      </ng-template>
                                    </span>
                                
                          </ion-col>
                          <ion-col col-8 text-center style="margin-top: 5%" (tap)="goToRecycler(recycler)">
                              <h2>{{recycler.name}}</h2>
                          </ion-col>
                          <ion-col col-2>
                              <ion-item (click)="doCallNumber(recycler.phone)">
                                <ion-icon ios="ios-call" md="md-call" color="vibrant" item-start large></ion-icon>
                              </ion-item>
                          </ion-col>
                        </ion-row>
                      </ion-grid>
                </ion-col>

                <ng-template #loading>
                  <ion-grid>
                    <ion-row justify-content-center>
                      <ion-col col-2>
                        <ion-spinner name="circles"></ion-spinner>
                      </ion-col>
                      <ion-col col-6>
                        Cargando favoritos...
                      </ion-col>
                    </ion-row>
                  </ion-grid>
                </ng-template>
              </ion-row>


              
              

                <!--ion-card text-center>
                  <ion-card-content>
                    <ion-item text-center>Debes iniciar sesión</ion-item>
                    <div >Y registra tus registradores favoritos</div>
                    <ion-row text-center>
                      <ion-col col-12>
                        <button ion-button round>Iniciar Sesión</button>
                      </ion-col>
                     </ion-row>
                  </ion-card-content>
                </ion-card-->

            </ion-list>

            <!--ion-list *ngSwitchCase="'near'" >
                <ion-card text-center>
                  <ion-card-content>
                    <ion-item text-center>Debes iniciar sesión</ion-item>
                    <div >Para ver nuestros negocios asociados</div>
                    <ion-row text-center>
                      <ion-col col-12>
                        <button ion-button round>Iniciar Sesión</button>
                      </ion-col>
                     </ion-row>
                  </ion-card-content>
                </ion-card>
            </ion-list-->
          </div>
        </ion-item>

</ion-content>
